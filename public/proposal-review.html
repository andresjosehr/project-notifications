<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisar Propuesta - Sistema Freelance</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-nav">
                <a href="index.html" class="nav-link">üè† Inicio</a>
                <a href="users.html" class="nav-link">üë• Usuarios</a>
                <a href="projects.html" class="nav-link">üìã Proyectos</a>
                <a href="control.html" class="nav-link">‚öôÔ∏è Control Panel</a>
                <div class="header-user">
                    <span id="currentUser">Cargando...</span>
                    <button class="btn btn-secondary btn-small" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
            </div>
            <h1>üìù Revisar Propuesta</h1>
            <p>Revisa y edita la propuesta antes de enviarla a Workana</p>
        </div>

        <div class="main-content">
            <div class="alert alert-success" id="successAlert"></div>
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-info" id="infoAlert"></div>

            <!-- Loading State -->
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Generando propuesta con IA...</p>
            </div>

            <!-- Proposal Review Section -->
            <div id="proposalReviewSection" class="section hidden">
                <div class="proposal-layout">
                    <!-- Project Information Column -->
                    <div class="project-column">
                        <div class="section">
                            <h2 class="section-title">üìã Informaci√≥n del Proyecto</h2>
                            <div class="project-info-card">
                                <div class="project-header">
                                    <h3 class="project-title" id="projectTitle">-</h3>
                                    <div class="project-meta">
                                        <span class="platform-badge platform-workana" id="projectPlatform">Workana</span>
                                        <span class="project-date" id="projectDate">-</span>
                                    </div>
                                </div>
                                <div class="project-description" id="projectDescription"></div>
                                <div class="project-main-info">
                                    <div class="info-grid">
                                        <div class="info-item">
                                            <span class="budget-info" id="projectBudget">-</span>
                                        </div>
                                        <div class="info-item">
                                            <span id="projectDeadline">-</span>
                                        </div>
                                        <div class="info-item">
                                            <span id="projectCategory">-</span>
                                        </div>
                                        <div class="info-item">
                                            <span id="selectedUser">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Proposal Editor Column -->
                    <div class="proposal-column">
                        <div class="section">
                            <h2 class="section-title">
                                ‚úèÔ∏è Editar Propuesta
                                <div class="section-actions">
                                    <button class="btn btn-info btn-small" onclick="regenerateProposal()">
                                        üîÑ Regenerar Propuesta
                                    </button>
                                    <button class="btn btn-secondary btn-small" onclick="resetProposal()">
                                        ‚Ü©Ô∏è Restaurar Original
                                    </button>
                                </div>
                            </h2>
                            
                            <div class="form-container">
                                <div class="form-group">
                                    <label for="proposalContent">
                                        üìù Contenido de la Propuesta
                                        <span class="form-help">Puedes editar el texto de la propuesta antes de enviarla</span>
                                    </label>
                                    <textarea 
                                        id="proposalContent" 
                                        class="proposal-editor"
                                        placeholder="La propuesta se est√° generando..."
                                        rows="20"
                                    ></textarea>
                                </div>
                                
                                <div class="proposal-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Caracteres:</span>
                                        <span id="charCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Palabras:</span>
                                        <span id="wordCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">L√≠neas:</span>
                                        <span id="lineCount">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="section">
                            <div class="proposal-actions">
                                <button class="btn btn-success btn-large" onclick="sendProposal()">
                                    üì§ Enviar Propuesta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sending State -->
            <div id="sendingState" class="loading hidden">
                <div class="spinner"></div>
                <p>Enviando propuesta a Workana...</p>
                <div class="proposal-progress">
                    <div class="proposal-status" id="sendingStatus">Preparando env√≠o...</div>
                    <div class="progress-details" id="sendingDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirmar Env√≠o</h2>
                <span class="close" onclick="closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">¬øEst√°s seguro de que quieres enviar esta propuesta?</p>
                <div class="proposal-preview" id="proposalPreview">
                    <!-- Proposal preview will be shown here -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-success" onclick="confirmSend()">
                        ‚úÖ Confirmar y Enviar
                    </button>
                    <button class="btn btn-secondary" onclick="closeConfirmModal()">
                        ‚ùå Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/components.js"></script>
    <script src="js/proposal-review.js"></script>
    <script>
        // Check if user is authenticated
        document.addEventListener('DOMContentLoaded', function() {
            if (!Utils.isAuthenticated()) {
                Utils.checkAuthRedirect();
                return;
            }

            // Display current user info
            const userInfo = Utils.getUserInfo();
            if (userInfo) {
                document.getElementById('currentUser').textContent = userInfo.email;
            }

            // Initialize proposal review
            initializeProposalReview();
        });

        // Logout function
        function logout() {
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                Utils.logout();
            }
        }
    </script>
</body>
</html>